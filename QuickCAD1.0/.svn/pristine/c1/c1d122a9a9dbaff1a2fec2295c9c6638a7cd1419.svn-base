<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui-v2.9.2/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="layui-form layuimini-form">
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label required">主键Id</label>
            <div class="layui-input-block">
                <input id="id" name="id" type="text" placeholder="请输入主键Id" value="" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label required">启用状态</label>
            <div class="layui-input-block">
                <input id="isUsable" name="isUsable" type="checkbox" lay-skin="switch" title="启用|禁用" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label required">串口名称</label>
            <div class="layui-input-block">
                <input id="portName" name="portName" type="text" placeholder="请输入串口名称" value="" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">波特率</label>
            <div class="layui-input-block">
                <select id="baudRate" name="baudRate" lay-verify="required" lay-search="">
                    <option value="115200" selected>115200</option>
                    <option value="57600">57600</option>
                    <option value="38400">38400</option>
                    <option value="19200">19200</option>
                    <option value="9600">9600</option>
                    <option value="4800">4800</option>
                    <option value="2400">2400</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">数据位</label>
            <div class="layui-input-block">
                <select id="dataBit" name="dataBit" lay-verify="required" lay-search="">
                    <option value="8" selected>8</option>
                    <option value="7">7</option>
                    <option value="6">6</option>
                    <option value="5">5</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">停止位</label>
            <div class="layui-input-block">
                <select id="stopBit" name="stopBit" lay-verify="required" lay-search="">
                    <option value="0" selected>1</option>
                    <option value="1">1.5</option>
                    <option value="2">2</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">校验位</label>
            <div class="layui-input-block">
                <select id="parity" name="parity" lay-verify="required" lay-search="">
                    <option value="0" selected>None</option>
                    <option value="1">Odd</option>
                    <option value="2">Even</option>
                    <option value="3">Mark</option>
                    <option value="4">Space</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">隔离器模式</label>
            <div class="layui-input-block">
                <select id="bizType" name="bizType" lay-verify="required" lay-search="">
                    <option value="0">双向模式</option>
                    <option value="1" selected>生产者模式</option>
                    <option value="2">消费者模式</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">生产文件缓存路径</label>
            <div class="layui-input-block">
                <input id="produceCachePath" name="produceCachePath" type="text" placeholder="请输入生产文件缓存路径" value="" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">是否备份生产文件</label>
            <div class="layui-input-block">
                <input id="isBackupProduce" name="isBackupProduce" type="checkbox" lay-skin="switch" title="备份|不备份">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">生产文件备份路径</label>
            <div class="layui-input-block">
                <input id="produceBackupPath" name="produceBackupPath" type="text" placeholder="请输入生产文件备份路径" value="" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">消费文件缓存路径</label>
            <div class="layui-input-block">
                <input id="consumeCachePath" name="consumeCachePath" type="text" placeholder="请输入消费文件缓存路径" value="" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">是否备份消费文件</label>
            <div class="layui-input-block">
                <input id="isBackupConsume" name="isBackupConsume" type="checkbox" lay-skin="switch" title="备份|不备份">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">消费文件备份路径</label>
            <div class="layui-input-block">
                <input id="consumeBackupPath" name="consumeBackupPath" type="text" placeholder="请输入消费文件备份路径" value="" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">管道大小</label>
            <div class="layui-input-block">
                <input id="channelSize" name="channelSize" type="number" autocomplete="off" class="layui-input" min="1" step="1" lay-affix="number" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">数量大小</label>
            <div class="layui-input-block">
                <input id="itemSize" name="itemSize" type="number" autocomplete="off" class="layui-input" min="1" step="1" lay-affix="number" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">容积大小</label>
            <div class="layui-input-block">
                <input id="bulkSize" name="bulkSize" type="number" autocomplete="off" class="layui-input" min="1" step="1" lay-affix="number" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">是否压缩</label>
            <div class="layui-input-block">
                <input id="isZip" name="isZip" type="checkbox" lay-skin="switch" title="压缩|不压缩">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label required">隔离器描述</label>
            <div class="layui-input-block">
                <input id="iDescribe" name="iDescribe" type="text" placeholder="请输入隔离器描述" value="" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item" id="saveBtn">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn" id="saveBtn1">确认保存</button>
            </div>
        </div>
        <hr>
        <div style="color: #666;margin-top: 30px;margin-bottom: 40px;padding-left: 30px;">
            <h3>说明1</h3><br>
            <h4>说明2</h4>
            <p>如果需要，这里可以放一些说明。</p><br>
            <h4>说明3</h4>
            <p>如果需要，这里可以放一些说明。</p>
        </div>
    </div>
    </div>
    <script src="/lib/layui-v2.9.2/layui.js" charset="utf-8"></script>
    <script>
        var parentMod = parent.parentMod;//全局变量，子页面获取父页面传来的参数。
        var subPageState = parent.subPageState;//全局变量，子页面状态('copy','look','add','edit')
        layui.use(['form'], function () {
            var form = layui.form;
            var layer = layui.layer;
            var $ = layui.$;
            var apiUrl;//接口地址
            Init();//页面初始化

            function Init() {
                switch (subPageState) {
                    case 'look': { //查看
                        $('#saveBtn').hide();//隐藏，不占位
                        $("#id").val(parentMod.id);
                        $('#id').attr("disabled", true);//禁用
                        $('#isUsable').attr('checked', parentMod.isUsable);
                        $('#isUsable').attr("disabled", true);//禁用
                        $("#portName").val(parentMod.portName);
                        $('#portName').attr("disabled", true);
                        $("#baudRate").val(parentMod.baudRate);
                        $('#baudRate').attr("disabled", true);
                        $("#dataBit").val(parentMod.dataBit);
                        $('#dataBit').attr("disabled", true);
                        $("#stopBit").val(parentMod.stopBit);
                        $('#stopBit').attr("disabled", true);
                        $("#parity").val(parentMod.parity);
                        $('#parity').attr("disabled", true);
                        $("#mode").attr('checked', parentMod.mode);
                        $('#mode').attr("disabled", true);//禁用
                        $("#produceCachePath").val(parentMod.produceCachePath);
                        $('#produceCachePath').attr("disabled", true);//禁用
                        $('#isBackupProduce').attr('checked', parentMod.isBackupProduce);
                        $('#isBackupProduce').attr("disabled", true);//禁用
                        $("#produceBackupPath").val(parentMod.produceBackupPath);
                        $('#produceBackupPath').attr("disabled", true);//禁用
                        $("#consumeCachePath").val(parentMod.consumeCachePath);
                        $('#consumeCachePath').attr("disabled", true);//禁用
                        $('#isBackupConsume').attr('checked', parentMod.isBackupConsume);
                        $('#isBackupConsume').attr("disabled", true);//禁用
                        $("#consumeBackupPath").val(parentMod.consumeBackupPath);
                        $('#consumeBackupPath').attr("disabled", true);//禁用
                        $("#channelSize").val(parentMod.channelSize);
                        $('#channelSize').attr("disabled", true);//禁用
                        $("#itemSize").val(parentMod.itemSize);
                        $('#itemSize').attr("disabled", true);//禁用
                        $("#bulkSize").val(parentMod.bulkSize);
                        $('#bulkSize').attr("disabled", true);//禁用
                        $('#isZip').attr('checked', parentMod.isZip);
                        $('#isZip').attr("disabled", true);//禁用
                        $("#iDescribe").val(parentMod.iDescribe);
                        $('#iDescribe').attr("disabled", true);//禁用
                        form.render('checkbox');
                        form.render("select");
                    } break;
                    case 'add': { //新增
                        apiUrl = '/SerialPort/Add';
                    } break;
                    case 'edit': { //编辑
                        apiUrl = '/SerialPort/Update';
                        $("#id").val(parentMod.id);
                        $('#id').attr("disabled", true);//禁用
                        $('#isUsable').attr('checked', parentMod.isUsable);
                        $("#portName").val(parentMod.portName);
                        $("#baudRate").val(parentMod.baudRate);
                        $("#dataBit").val(parentMod.dataBit);
                        $("#stopBit").val(parentMod.stopBit);
                        $("#parity").val(parentMod.parity);
                        $("#mode").attr('checked', parentMod.mode);
                        $("#produceCachePath").val(parentMod.produceCachePath);
                        $('#isBackupProduce').attr('checked', parentMod.isBackupProduce);
                        $("#produceBackupPath").val(parentMod.produceBackupPath);
                        $("#consumeCachePath").val(parentMod.consumeCachePath);
                        $('#isBackupConsume').attr('checked', parentMod.isBackupConsume);
                        $("#consumeBackupPath").val(parentMod.consumeBackupPath);
                        $("#channelSize").val(parentMod.channelSize);
                        $("#itemSize").val(parentMod.itemSize);
                        $("#bulkSize").val(parentMod.bulkSize);
                        $('#isZip').attr('checked', parentMod.isZip);
                        $("#iDescribe").val(parentMod.iDescribe);
                        form.render('checkbox');
                        form.render("select");
                    } break;
                    case 'copy': { //拷贝
                        apiUrl = '/SerialPort/Add';
                        $("#id").val(parentMod.id);
                        $('#isUsable').attr('checked', parentMod.isUsable);
                        $("#portName").val(parentMod.portName);
                        $("#baudRate").val(parentMod.baudRate);
                        $("#dataBit").val(parentMod.dataBit);
                        $("#stopBit").val(parentMod.stopBit);
                        $("#parity").val(parentMod.parity);
                        $("#mode").attr('checked', parentMod.mode);
                        $("#produceCachePath").val(parentMod.produceCachePath);
                        $('#isBackupProduce').attr('checked', parentMod.isBackupProduce);
                        $("#produceBackupPath").val(parentMod.produceBackupPath);
                        $("#consumeCachePath").val(parentMod.consumeCachePath);
                        $('#isBackupConsume').attr('checked', parentMod.isBackupConsume);
                        $("#consumeBackupPath").val(parentMod.consumeBackupPath);
                        $("#channelSize").val(parentMod.channelSize);
                        $("#itemSize").val(parentMod.itemSize);
                        $("#bulkSize").val(parentMod.bulkSize);
                        $('#isZip').attr('checked', parentMod.isZip);
                        $("#iDescribe").val(parentMod.iDescribe);
                        form.render('checkbox');
                        form.render("select");
                    } break;
                    default: break;
                }
            }

            //监听提交
            form.on('submit(saveBtn)', function (data) {
                data.field.isUsable = data.field.isUsable == "on" ? true : false;
                data.field.isBackupProduce = data.field.isBackupProduce == "on" ? true : false;
                data.field.isZip = data.field.isZip == "on" ? true : false;
                $.ajax({
                    type: 'POST',
                    url: apiUrl, //接口地址
                    cache: false, //是否使用缓存
                    dataType: "json",//数据类型
                    data: data.field,//form数据
                    success: function (res) {//函数参数 "data" 为请求成功服务端返回的数据
                        layer.msg(res.msg);
                        if (res.code == 0) {
                            window.parent.location.reload();
                            var iframeIndex = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(iframeIndex);//关闭iframe
                        }
                    },
                    error: function (err) {
                        layer.msg("接口【" + apiUrl + "】请求错误，状态码：" + err.status);
                        if (err.status == 401) {
                            parent.location.href = "/Hmoe/Login";
                        }
                    }
                });

                return false;
            });
        });
    </script>
</body>
</html>